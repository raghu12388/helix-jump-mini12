<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Stack Ball Mini</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

<style>
html,body{
  margin:0;
  padding:0;
  overflow:hidden;
  background:#111;
  touch-action:none;
  font-family:Arial, sans-serif;
}
#ui{
  position:fixed;
  top:10px;
  left:50%;
  transform:translateX(-50%);
  background:rgba(0,0,0,0.6);
  color:#fff;
  padding:8px 14px;
  border-radius:8px;
  font-size:14px;
  display:flex;
  gap:15px;
}
#combo{color:#ffcc00}
#fire{color:#ff4500;font-weight:bold;display:none}
</style>
</head>

<body>

<div id="ui">
  Score: <span id="score">0</span>
  <span id="combo">Combo x0</span>
  <span id="fire">ðŸ”¥ FIRE</span>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>

<script>
/* ================= AUDIO + VIBRATION ================= */
let audioReady = false;
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

function playSound(freq=400, dur=0.07){
  if(!audioReady) return;
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();
  osc.frequency.value = freq;
  osc.type = "sine";
  gain.gain.value = 0.12;
  osc.connect(gain);
  gain.connect(audioCtx.destination);
  osc.start();
  osc.stop(audioCtx.currentTime + dur);
}
const vibrate = p => navigator.vibrate && navigator.vibrate(p);

/* ================= SCENE ================= */
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x111111);

const camera = new THREE.PerspectiveCamera(60, innerWidth/innerHeight, 0.1, 100);
camera.position.set(0,6,10);

const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth,innerHeight);
renderer.setPixelRatio(Math.min(devicePixelRatio,1.5));
document.body.appendChild(renderer.domElement);

/* ================= LIGHT ================= */
scene.add(new THREE.AmbientLight(0xffffff,0.7));
const light = new THREE.DirectionalLight(0xffffff,0.8);
light.position.set(5,10,5);
scene.add(light);

/* ================= UI DATA ================= */
let score = 0;
let combo = 0;
let fireMode = false;

const scoreEl = document.getElementById("score");
const comboEl = document.getElementById("combo");
const fireEl  = document.getElementById("fire");

/* ================= BALL ================= */
const ballMat = new THREE.MeshStandardMaterial({color:0xff8800});
const ball = new THREE.Mesh(
  new THREE.SphereGeometry(0.6,32,32),
  ballMat
);
ball.position.y = 4;
scene.add(ball);

/* ================= STACK ================= */
const platforms=[];
const levelCount = 16;

function createPlatform(y){
  const danger = Math.random() < 0.25;
  const platform = new THREE.Mesh(
    new THREE.CylinderGeometry(3,3,0.6,32),
    new THREE.MeshStandardMaterial({
      color: danger ? 0xff3333 : 0x00ff99
    })
  );
  platform.position.y = y;
  platform.userData.danger = danger;
  scene.add(platform);
  platforms.push(platform);
}

for(let i=0;i<levelCount;i++){
  createPlatform(-i*1.5);
}

/* ================= PHYSICS ================= */
let velocity = 0;
const gravity = -0.015;
let smashing = false;

/* ================= INPUT ================= */
addEventListener("pointerdown",()=>{
  audioReady = true;
  audioCtx.resume();
  smashing = true;
  playSound(600,0.05);
  vibrate(15);
});

addEventListener("pointerup",()=>{
  smashing = false;
  combo = 0;
  fireMode = false;
  comboEl.textContent = "Combo x0";
  fireEl.style.display = "none";
  ballMat.emissive.setHex(0x000000);
});

/* ================= GAME LOOP ================= */
function animate(){
  requestAnimationFrame(animate);

  velocity += gravity;
  ball.position.y += velocity;

  platforms.forEach((p,i)=>{
    if(
      ball.position.y < p.position.y + 0.8 &&
      ball.position.y > p.position.y - 0.8
    ){
      if(smashing){
        // SMASH
        scene.remove(p);
        platforms.splice(i,1);

        combo++;
        score += fireMode ? 30 : 10;
        scoreEl.textContent = score;
        comboEl.textContent = "Combo x" + combo;

        playSound(350,0.07);
        vibrate(20);

        if(combo >= 5){
          fireMode = true;
          fireEl.style.display = "inline";
          ballMat.emissive.setHex(0xff3300);
          playSound(120,0.2);
          vibrate([40,20,40]);
        }

        velocity = -0.35;
      }else{
        if(p.userData.danger && !fireMode){
          // GAME OVER
          playSound(150,0.3);
          vibrate([60,40,60]);

          score = 0;
          combo = 0;
          fireMode = false;
          scoreEl.textContent = 0;
          comboEl.textContent = "Combo x0";
          fireEl.style.display = "none";
          ballMat.emissive.setHex(0x000000);

          ball.position.y = 4;
          velocity = 0;
        }else{
          // BOUNCE
          velocity = 0.25;
          combo = 0;
          fireMode = false;
          comboEl.textContent = "Combo x0";
          fireEl.style.display = "none";
          ballMat.emissive.setHex(0x000000);

          playSound(500,0.06);
          vibrate(10);
        }
      }
    }
  });

  camera.position.y = ball.position.y + 6;
  camera.lookAt(ball.position);

  renderer.render(scene,camera);
}
animate();

/* ================= RESIZE ================= */
addEventListener("resize",()=>{
  camera.aspect = innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth,innerHeight);
});
</script>

</body>
</html>











