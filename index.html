<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Stack Ball Mini</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

<style>
html,body{
  margin:0;
  padding:0;
  overflow:hidden;
  background:#111;
  touch-action:none;
  font-family:Arial, sans-serif;
}

/* HUD */
#ui{
  position:fixed;
  top:10px;
  left:50%;
  transform:translateX(-50%);
  background:rgba(0,0,0,0.6);
  color:#fff;
  padding:8px 14px;
  border-radius:8px;
  font-size:14px;
  display:flex;
  gap:15px;
  z-index:10;
}
#combo{color:#ffcc00}
#fire{color:#ff4500;font-weight:bold;display:none}
#coins{color:#00ff99}

/* GAME OVER */
#gameover{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.85);
  color:#fff;
  display:none;
  align-items:center;
  justify-content:center;
  flex-direction:column;
  z-index:20;
}
#gameover button{
  margin-top:12px;
  padding:10px 20px;
  border:none;
  border-radius:8px;
  font-size:16px;
  font-weight:bold;
  background:#00ff99;
  color:#000;
}
#reward{
  background:#222;
  padding:12px 20px;
  border-radius:10px;
  margin-top:10px;
  text-align:center;
}
</style>
</head>

<body>

<div id="ui">
  Score: <span id="score">0</span>
  <span id="combo">Combo x0</span>
  <span id="fire">üî• FIRE</span>
  <span id="coins">ü™ô 0</span>
</div>

<div id="gameover">
  <h2>GAME OVER</h2>
  <div>Score: <span id="finalScore">0</span></div>

  <div id="reward">
    üéÅ Watch Reward<br>
    Get <b>+50 Coins</b>
  </div>

  <button id="restart">RESTART</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>

<script>
/* ================= STORAGE ================= */
let coins = parseInt(localStorage.getItem("coins") || "0");
const coinsEl = document.getElementById("coins");
coinsEl.textContent = "ü™ô " + coins;
function addCoins(v){
  coins += v;
  localStorage.setItem("coins", coins);
  coinsEl.textContent = "ü™ô " + coins;
}

/* ================= SCENE ================= */
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x111111);

const camera = new THREE.PerspectiveCamera(60, innerWidth/innerHeight, 0.1, 100);
camera.position.set(0,6,10);

const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth,innerHeight);
renderer.setPixelRatio(Math.min(devicePixelRatio,1.5));
document.body.appendChild(renderer.domElement);

/* ================= LIGHT ================= */
scene.add(new THREE.AmbientLight(0xffffff,0.7));
const light = new THREE.DirectionalLight(0xffffff,0.8);
light.position.set(5,10,5);
scene.add(light);

/* ================= UI DATA ================= */
let score = 0;
let combo = 0;
let fireMode = false;
let gameRunning = true;

const scoreEl = document.getElementById("score");
const comboEl = document.getElementById("combo");
const fireEl  = document.getElementById("fire");
const gameOverBox = document.getElementById("gameover");
const finalScoreEl = document.getElementById("finalScore");

/* ================= BALL ================= */
const ballMat = new THREE.MeshStandardMaterial({color:0xff8800});
const ball = new THREE.Mesh(
  new THREE.SphereGeometry(0.6,32,32),
  ballMat
);
scene.add(ball);

/* ================= STACK ================= */
let platforms=[];
const levelCount=16;

function createPlatform(y){
  const danger = Math.random()<0.25;
  const p = new THREE.Mesh(
    new THREE.CylinderGeometry(3,3,0.6,32),
    new THREE.MeshStandardMaterial({
      color: danger ? 0xff3333 : 0x00ff99
    })
  );
  p.position.y=y;
  p.userData.danger=danger;
  scene.add(p);
  platforms.push(p);
}

function buildStack(){
  platforms.forEach(p=>scene.remove(p));
  platforms=[];
  for(let i=0;i<levelCount;i++){
    createPlatform(-i*1.5);
  }
}

/* ================= PHYSICS ================= */
let velocity=0;
const gravity=-0.015;
let smashing=false;

/* ================= INPUT ================= */
addEventListener("pointerdown",()=>{ if(gameRunning) smashing=true; });
addEventListener("pointerup",()=>{
  smashing=false;
  combo=0;
  fireMode=false;
  comboEl.textContent="Combo x0";
  fireEl.style.display="none";
  ballMat.emissive.setHex(0x000000);
});

/* ================= GAME OVER ================= */
function gameOver(){
  gameRunning=false;
  finalScoreEl.textContent=score;
  gameOverBox.style.display="flex";
}

/* ================= REWARD ================= */
document.getElementById("reward").onclick=()=>{
  addCoins(50);   // reward coins
  document.getElementById("reward").innerHTML="‚úÖ Reward Claimed!";
};

/* ================= RESTART ================= */
document.getElementById("restart").onclick=()=>{
  score=0;
  combo=0;
  fireMode=false;
  scoreEl.textContent=0;
  comboEl.textContent="Combo x0";
  fireEl.style.display="none";
  ballMat.emissive.setHex(0x000000);

  ball.position.y=4;
  velocity=0;

  buildStack();
  gameOverBox.style.display="none";
  gameRunning=true;
};

/* ================= START ================= */
buildStack();
ball.position.y=4;

/* ================= LOOP ================= */
function animate(){
  requestAnimationFrame(animate);
  if(!gameRunning){
    renderer.render(scene,camera);
    return;
  }

  velocity+=gravity;
  ball.p
